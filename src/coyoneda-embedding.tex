\documentclass[tikz]{standalone}

\usetikzlibrary{cd,positioning}
\include{macro}

\begin{document}
\def\C{\cat{C}}
\begin{tikzpicture}
	% Set
	\node (s) {$\set$};
	\node [below right=0.1cm and -1.5cm of s] (scom) {
		\begin{tikzcd}[row sep=1.0cm, column sep=1.5cm]
			\mrps{\cat{C}}{a}{x}\arrow{r}{\mrps{\cat{C}}{a}{\psi}}[swap]{-\circ\phi}
			& \mrps{\cat{C}}{a}{y} \\
			\mrps{\cat{C}}{b}{x}\arrow{r}{\phi\circ-}[swap]{\mrps{\cat{C}}{b}{\phi}}\arrow{u}{\mrps{\cat{C}}{\psi}{x}}[swap]{\psi\circ-}
			& \mrps{\cat{C}}{b}{y}\arrow{u}{-\circ\psi}[swap]{\mrps{\cat{C}}{\psi}{y}}
		\end{tikzcd}
	};
	\node [above left = 0.1cm and  0.5cm of s]    (srec1) {};
	\node [below right=-0.1cm and -0.2cm of scom] (srec2) {};
	\draw [draw=blue!70,rounded corners=10] (srec1) rectangle (srec2);

	% source category
	\node [left =4.0cm of s] (c)   {$\C$};
	\node [above=1.2cm of c] (opc) {$\op{\C}$};
	\node [below=0.7cm of c] (y)   {$y$};
	\node [left =0.4cm of y] (x)   {$x$};
	\node [above=0.1cm of x] (b)   {$b$};
	\node [above=0.3cm of b] (a)   {$a$};
	\draw [->] (a) to node [right] {\scriptsize$\psi$} (b);
	\draw [->] (x) to node [above] {\scriptsize$\phi$} (y);
	\node [above left =0.0cm and 0.1cm of a] (crec1) {};
	\node [below right=0.0cm and 0.1cm of y] (crec2) {};
	\draw [draw=gray,rounded corners=10] (crec1) rectangle (crec2);

	% functor category
	\node [right=1.5cm of opc] (f) {$\set^\C$};
	\draw [->, bend left =20] (c) to node (ya) [above] {$\mrps{\C}{a}{-}$} (s);
	\draw [->, bend right=20] (c) to node (yb) [below] {$\mrps{\C}{b}{-}$} (s);
	\draw [->, double] (ya) to node [right] {\scriptsize$\mrps{\C}{\psi}{-}$} (yb);
	\draw [->] (c) to node [right] {$\mathrm{id}^\mathrm{op}_\C$} (opc);
	\draw [->] (opc) to node [above left=0cm and -0.1cm] {$\textbf{ã‚ˆ}'$} (f);
	\node [above left =0.0cm and 0.5cm of f] (frec1) {};
	\node [below right=0.0cm and 0.4cm of yb] (frec2) {};
	\draw [draw=red!60,rounded corners=10] (frec1) rectangle (frec2);
\end{tikzpicture}
\end{document}
